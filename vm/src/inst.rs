#[derive(Clone, Copy)]
pub enum Inst {
    Immediate(u8),
    Insert(u8),
    Swap,
    High,
    Low,
    Zero,
    Reset,
    Goto,
    Jump,
    Position,
    Left,
    Right,
    Up,
    Down,
    Inc,
    Dec,
    Add,
    Sub,
    Mul,
    Div,
    Clear,
    Raise,
    Neg,
    Bool,
    Eq,
    Lt,
    Gt,
    Not,
    And,
    Or,
    Xor,
    Shl,
    Shr,
    Rotl,
    Rotr,
    Load,
    Store,
    Delete,
    Put,
    Get,
    Save,
    Restore,
    Argc,
    Argv,
    Eval,
    Ctrl,
    Nop,
}
impl Inst {
    #[allow(clippy::match_same_arms)]
    pub fn new(key: char) -> Self {
        match key {
            '\n' => Inst::Ctrl,
            '!' => Inst::Neg,
            '"' => Inst::Ctrl,
            '#' => Inst::Ctrl,
            '$' => Inst::Argv,
            '%' => Inst::Argc,
            '&' => Inst::And,
            '\'' => Inst::Ctrl,
            '(' => Inst::High,
            ')' => Inst::Low,
            '*' => Inst::Mul,
            '+' => Inst::Add,
            ',' => Inst::Get,
            '-' => Inst::Sub,
            '.' => Inst::Put,
            '/' => Inst::Div,
            '0'..='9' => Inst::Insert(translate_hex_digit(key)),
            ':' => Inst::Nop,
            ';' => Inst::Nop,
            '<' => Inst::Lt,
            '=' => Inst::Eq,
            '>' => Inst::Gt,
            '?' => Inst::Bool,
            '@' => Inst::Nop,
            'A'..='Z' => Inst::new(key.to_ascii_lowercase()),
            '[' => Inst::Shl,
            '\\' => Inst::Raise,
            ']' => Inst::Shr,
            '^' => Inst::Xor,
            '_' => Inst::Clear,
            '`' => Inst::Eval,
            'a'..='f' => Inst::Insert(translate_hex_digit(key)),
            'g' => Inst::Goto,
            'h' => Inst::Left,
            'i' => Inst::Load,
            'j' => Inst::Down,
            'k' => Inst::Up,
            'l' => Inst::Right,
            'm' => Inst::Dec,
            'n' => Inst::Inc,
            'o' => Inst::Store,
            'p' => Inst::Nop,
            'q' => Inst::Nop,
            'r' => Inst::Restore,
            's' => Inst::Save,
            't' => Inst::Jump,
            'u' => Inst::Nop,
            'v' => Inst::Position,
            'w' => Inst::Swap,
            'x' => Inst::Delete,
            'y' => Inst::Reset,
            'z' => Inst::Zero,
            '{' => Inst::Rotl,
            '|' => Inst::Or,
            '}' => Inst::Rotr,
            '~' => Inst::Not,
            _ => Inst::Nop,
        }
    }
}

fn translate_hex_digit(key: char) -> u8 {
    const ZERO: u8 = b'0';
    const A: u8 = b'a';
    match key {
        '0'..='9' => key as u8 - ZERO,
        'a'..='f' => key as u8 - A + 0xA,
        _ => unreachable!(),
    }
}
