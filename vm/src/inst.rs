pub type Name = Vec<u8>;
pub type Seq = Vec<Inst>;

#[derive(Clone, PartialEq, Debug)]
pub enum Inst {
    Insert(u8),
    High,
    Low,
    Swap,
    Zero,
    Delete,
    Right,
    Left,
    Down,
    Up,
    Goto,
    Jump,
    Coord,
    Page,
    Origin,
    Begin,
    Add,
    Sub,
    Mul,
    Div,
    Inc,
    Dec,
    Shl,
    Shr,
    Rotl,
    Rotr,
    And,
    Or,
    Xor,
    Not,
    Neg,
    Bool,
    Eq,
    Lt,
    Gt,
    Check,
    Clear,
    Save,
    Mark,
    Load,
    Store,
    Getchar,
    Putchar,
    Stream,
    Direct(u8),
    Quote(Name),
    Register(u8, Seq),
    Exec(u8),
    Repeat(u8),
    Eval,
    Define(Name, Seq),
    Invoke(Name),
    Nop,
    Skip,
}
impl Inst {
    #[allow(clippy::match_same_arms)]
    pub fn new(key: u8) -> Self {
        match key as char {
            '!' => Inst::Neg,
            '"' => unreachable!(),
            '#' => unreachable!(),
            '$' => unreachable!(),
            '%' => Inst::Stream,
            '&' => Inst::And,
            '\'' => unreachable!(),
            '(' => Inst::Rotl,
            ')' => Inst::Rotr,
            '*' => Inst::Mul,
            '+' => Inst::Add,
            ',' => Inst::Getchar,
            '-' => Inst::Sub,
            '.' => Inst::Putchar,
            '/' => Inst::Div,
            '0'..='9' => Self::translate_hex_digit(key),
            ':' => unreachable!(),
            ';' => unreachable!(),
            '<' => Inst::Lt,
            '=' => Inst::Eq,
            '>' => Inst::Gt,
            '?' => Inst::Bool,
            '@' => unreachable!(),
            'A'..='Z' => Self::translate_lowercase(key),
            '[' => Inst::Inc,
            '\\' => Inst::Check,
            ']' => Inst::Dec,
            '^' => Inst::Xor,
            '_' => Inst::Clear,
            '`' => Inst::Eval,
            'a'..='f' => Self::translate_hex_digit(key),
            'g' => Inst::Goto,
            'h' => Inst::Left,
            'i' => Inst::High,
            'j' => Inst::Down,
            'k' => Inst::Up,
            'l' => Inst::Right,
            'm' => Inst::Origin,
            'n' => Inst::Begin,
            'o' => Inst::Low,
            'p' => Inst::Swap,
            'q' => unreachable!(),
            'r' => Inst::Load,
            's' => Inst::Save,
            't' => Inst::Jump,
            'u' => Inst::Coord,
            'v' => Inst::Mark,
            'w' => Inst::Store,
            'x' => Inst::Delete,
            'y' => Inst::Page,
            'z' => Inst::Zero,
            '{' => Inst::Shl,
            '|' => Inst::Or,
            '}' => Inst::Shr,
            '~' => Inst::Not,
            _ => Inst::Nop,
        }
    }
    fn translate_hex_digit(key: u8) -> Inst {
        const ZERO: u8 = b'0';
        const NINE: u8 = b'9';
        const A: u8 = b'a';
        const F: u8 = b'f';
        let digit = match key {
            ZERO..=NINE => key - ZERO,
            A..=F => key - A + 0xA,
            _ => unreachable!(),
        };
        Inst::Insert(digit)
    }
    fn translate_lowercase(key: u8) -> Inst {
        Inst::new(key.to_ascii_lowercase())
    }
}
